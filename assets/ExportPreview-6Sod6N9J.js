import{i as ee,r as te,n as t,ag as R,I as F,s as ne,X as se,Y as re,Z as I,$ as a,a0 as ae,a1 as o,z as oe,t as l}from"./index-DdIfFbXD.js";const ie=ee({root:{padding:l.spacingHorizontalM},controls:{display:"flex",alignItems:"end",gap:l.spacingHorizontalM,marginBottom:l.spacingVerticalM},spacer:{marginLeft:"auto"},tableWrapper:{overflow:"auto",maxHeight:"60vh",border:`1px solid ${l.colorNeutralStroke2}`,borderRadius:l.borderRadiusMedium},rowsText:{color:l.colorNeutralForeground3,marginTop:l.spacingVerticalXS}});function ce({sqlDb:M,exportStart:f,exportEnd:x,setExportStart:C,setExportEnd:H,exportShifts:W,all:j,segmentTimesForDate:le,segmentTimesForPersonDate:S,listTimeOffIntervals:L,subtractIntervals:Y,groups:J,people:z,roles:A}){const m=ie();function u(e){return e<10?`0${e}`:`${e}`}function v(e){const s=e.getMonth()+1,d=e.getDate(),i=e.getFullYear();return`${s}/${d}/${i}`}function E(e){return`${u(e.getHours())}:${u(e.getMinutes())}`}function B(e){return`${e.getFullYear()}-${u(e.getMonth()+1)}-${u(e.getDate())}`}function N(e){const[s,d,i]=e.split("-").map(r=>parseInt(r,10));return new Date(s,d-1,i,0,0,0,0)}function X(e,s){return new Date(e.getTime()+s*6e4)}function P(e){switch(e.getDay()){case 1:return"Monday";case 2:return"Tuesday";case 3:return"Wednesday";case 4:return"Thursday";case 5:return"Friday";default:return"Weekend"}}const $=te.useMemo(()=>{if(!M)return[];const e=N(f),s=N(x);if(s<e)return[];const d=(c,w)=>{const[g,_]=w.split(":").map(Number);return new Date(c.getFullYear(),c.getMonth(),c.getDate(),g,_,0,0)},i=[];let r=new Date(e.getTime());for(;r<=s;){if(P(r)!=="Weekend"){const c=B(r),w=j(`SELECT de.title, de.start_time, de.end_time, g.name as group_name
             FROM department_event de
             LEFT JOIN grp g ON g.id = de.group_id
             WHERE de.date=?`,[c]),g=new Map;for(const n of w)g.set(n.title,{start_time:n.start_time,end_time:n.end_time,group_name:n.group_name??null});const _=j(`SELECT a.id, a.person_id, a.role_id, a.segment,
                  p.first_name, p.last_name, p.work_email,
                  r.name as role_name, r.code as role_code, r.group_id,
                  g.name as group_name
           FROM assignment a
           JOIN person p ON p.id=a.person_id
           JOIN role r ON r.id=a.role_id
           JOIN grp g  ON g.id=r.group_id
           WHERE a.date=?`,[c]),T=r.getDay()-1,G=T>=0&&T<=4?j(`SELECT rt.person_id, rt.start_time, rt.end_time, rt.reason,
                  p.first_name, p.last_name, p.work_email
           FROM recurring_timeoff rt
           JOIN person p ON p.id = rt.person_id
           WHERE rt.active = 1 AND rt.weekday = ?`,[T]):[],b=new Map;for(const n of _){const h=b.get(n.person_id)||[];h.push(n),b.set(n.person_id,h)}for(const n of _){const h=b.get(n.person_id)||[],V=S(r,h),p=g.get(n.segment),y=p?{start:d(r,p.start_time),end:d(r,p.end_time)}:V[n.segment];if(!y)continue;const Z=p?n.segment:n.role_name;let K=[{start:y.start,end:y.end}],D=p?.group_name||n.group_name;const Q=L(n.person_id,r);for(const k of K){const U=Y(k.start,k.end,Q);for(const O of U)i.push({date:v(r),member:`${n.last_name}, ${n.first_name}`,email:n.work_email,group:D,start:E(O.start),end:E(O.end),label:Z,color:J.find(q=>q.name===D)?.theme||""})}}for(const n of G)i.push({date:v(r),member:`${n.last_name}, ${n.first_name}`,email:n.work_email,group:"Time Away",start:n.start_time,end:n.end_time,label:"Time Away"+(n.reason?`: ${n.reason}`:""),color:"Gray"})}r=X(r,24*60)}return i},[M,f,x,z.length,A.length]);return t.jsxs("div",{className:m.root,children:[t.jsxs("div",{className:m.controls,children:[t.jsx(R,{label:"Start",children:t.jsx(F,{type:"date",value:f,onChange:(e,s)=>C(s.value)})}),t.jsx(R,{label:"End",children:t.jsx(F,{type:"date",value:x,onChange:(e,s)=>H(s.value)})}),t.jsx("div",{className:m.spacer}),t.jsx(ne,{appearance:"primary",onClick:W,children:"Download XLSX"})]}),t.jsx("div",{className:m.tableWrapper,children:t.jsxs(se,{"aria-label":"Export preview table",children:[t.jsx(re,{children:t.jsxs(I,{children:[t.jsx(a,{children:"Date"}),t.jsx(a,{children:"Member"}),t.jsx(a,{children:"Work Email"}),t.jsx(a,{children:"Group"}),t.jsx(a,{children:"Start"}),t.jsx(a,{children:"End"}),t.jsx(a,{children:"Custom Label"}),t.jsx(a,{children:"Theme"})]})}),t.jsx(ae,{children:$.map((e,s)=>t.jsxs(I,{children:[t.jsx(o,{children:e.date}),t.jsx(o,{children:e.member}),t.jsx(o,{children:e.email}),t.jsx(o,{children:e.group}),t.jsx(o,{children:e.start}),t.jsx(o,{children:e.end}),t.jsx(o,{children:e.label}),t.jsx(o,{children:e.color})]},s))})]})}),t.jsxs(oe,{size:200,className:m.rowsText,children:["Rows: ",$.length]})]})}export{ce as default};
